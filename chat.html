<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNICEF Palestine Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .typing-indicator {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        
        .language-switch {
            transition: all 0.3s ease;
        }
        
        .language-switch.active {
            background-color: #059669;
            color: white;
        }
        
        .whatsapp-share {
            background: #25D366;
            color: white;
        }
        
        .whatsapp-share:hover {
            background: #1ebe57;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-blue-600 text-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                            <i class="fas fa-hands-helping text-blue-600 text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-lg font-semibold" id="chatbotTitle">UNICEF Palestine Assistant</h1>
                            <p class="text-sm text-blue-100" id="subtitle">Ask me anything about UNICEF services</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <!-- Language Switch -->
                        <div class="flex bg-blue-700 rounded-lg p-1">
                            <button id="langEn" class="language-switch px-3 py-1 rounded text-sm active" onclick="switchLanguage('en')">
                                EN
                            </button>
                            <button id="langAr" class="language-switch px-3 py-1 rounded text-sm" onclick="switchLanguage('ar')">
                                عربي
                            </button>
                        </div>
                        <!-- Share Button -->
                        <button id="shareBtn" onclick="shareOnWhatsApp()" class="whatsapp-share px-3 py-2 rounded-lg text-sm flex items-center space-x-1">
                            <i class="fab fa-whatsapp"></i>
                            <span id="shareText">Share</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Chat Container -->
        <div class="flex-1 flex flex-col max-w-4xl mx-auto w-full">
            <!-- Welcome Message -->
            <div id="welcomeMessage" class="bg-white border-b p-4 text-center">
                <div class="max-w-2xl mx-auto">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-center mb-2">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                            <h3 class="font-semibold text-blue-800" id="welcomeTitle">Welcome to UNICEF Palestine Assistant</h3>
                        </div>
                        <p class="text-sm text-blue-700" id="welcomeText">
                            I'm here to help you with information about UNICEF services in Palestine. 
                            Ask me about child protection, cash assistance, health services, education support, and more.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
                <div id="messages" class="max-w-3xl mx-auto space-y-4">
                    <!-- Messages will be appended here -->
                </div>
                
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="max-w-3xl mx-auto hidden">
                    <div class="flex items-center space-x-2 text-gray-500">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-indicator"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-indicator" style="animation-delay: 0.2s;"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-indicator" style="animation-delay: 0.4s;"></div>
                        </div>
                        <span id="typingText">Assistant is typing...</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div id="quickActions" class="bg-white border-t p-4">
                <div class="max-w-3xl mx-auto">
                    <p class="text-sm text-gray-600 mb-3" id="quickActionsTitle">Quick questions:</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2" id="quickActionsGrid">
                        <!-- Quick action buttons will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="bg-white border-t p-4">
                <div class="max-w-3xl mx-auto">
                    <div class="flex space-x-3">
                        <div class="flex-1">
                            <input 
                                type="text" 
                                id="userInput" 
                                placeholder="Type your question here..." 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                onkeypress="handleKeyPress(event)"
                            >
                        </div>
                        <button 
                            onclick="sendMessage()" 
                            id="sendBtn"
                            class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center space-x-2"
                        >
                            <i class="fas fa-paper-plane"></i>
                            <span id="sendText">Send</span>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2 text-center" id="disclaimer">
                        This AI assistant provides information based on UNICEF resources. For urgent cases, contact emergency services directly.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLanguage = 'en';
        let chatHistory = [];
        let sessionId = generateSessionId();

        // Text content in both languages
        const translations = {
            en: {
                chatbotTitle: "UNICEF Palestine Assistant",
                subtitle: "Ask me anything about UNICEF services",
                welcomeTitle: "Welcome to UNICEF Palestine Assistant",
                welcomeText: "I'm here to help you with information about UNICEF services in Palestine. Ask me about child protection, cash assistance, health services, education support, and more.",
                quickActionsTitle: "Quick questions:",
                typingText: "Assistant is typing...",
                inputPlaceholder: "Type your question here...",
                sendText: "Send",
                shareText: "Share",
                disclaimer: "This AI assistant provides information based on UNICEF resources. For urgent cases, contact emergency services directly.",
                quickQuestions: [
                    "How do I register for cash assistance?",
                    "Where can I get health services?",
                    "What are child protection services?",
                    "How do I report an unaccompanied child?",
                    "What education support is available?",
                    "Are services free of charge?"
                ],
                categories: {
                    child_protection: "Child Protection",
                    cash_transfer: "Cash Assistance", 
                    health_nutrition: "Health & Nutrition",
                    education: "Education",
                    incentive_workers: "Incentive Workers",
                    fraud_categories: "Fraud & Complaints"
                }
            },
            ar: {
                chatbotTitle: "مساعد اليونيسف فلسطين",
                subtitle: "اسألني أي شيء عن خدمات اليونيسف",
                welcomeTitle: "مرحباً بك في مساعد اليونيسف فلسطين",
                welcomeText: "أنا هنا لمساعدتك في الحصول على معلومات حول خدمات اليونيسف في فلسطين. اسألني عن حماية الأطفال، المساعدة النقدية، الخدمات الصحية، الدعم التعليمي، والمزيد.",
                quickActionsTitle: "أسئلة سريعة:",
                typingText: "المساعد يكتب...",
                inputPlaceholder: "اكتب سؤالك هنا...",
                sendText: "إرسال",
                shareText: "مشاركة",
                disclaimer: "هذا المساعد الذكي يقدم معلومات بناءً على موارد اليونيسف. للحالات العاجلة، اتصل بخدمات الطوارئ مباشرة.",
                quickQuestions: [
                    "كيف أسجل للحصول على المساعدة النقدية؟",
                    "أين يمكنني الحصول على الخدمات الصحية؟",
                    "ما هي خدمات حماية الأطفال؟",
                    "كيف أبلغ عن طفل غير مرافق؟",
                    "ما الدعم التعليمي المتاح؟",
                    "هل الخدمات مجانية؟"
                ],
                categories: {
                    child_protection: "حماية الأطفال",
                    cash_transfer: "المساعدة النقدية",
                    health_nutrition: "الصحة والتغذية", 
                    education: "التعليم",
                    incentive_workers: "العمال المحفزون",
                    fraud_categories: "الاحتيال والشكاوى"
                }
            }
        };

        // Quick questions data
        const quickQuestionsData = {
            en: [
                { text: "How do I register for cash assistance?", query: "register cash assistance", category: "cash_transfer" },
                { text: "Where can I get health services?", query: "health services location", category: "health_nutrition" },
                { text: "What are child protection services?", query: "child protection services", category: "child_protection" },
                { text: "How do I report an unaccompanied child?", query: "report unaccompanied child", category: "child_protection" },
                { text: "What education support is available?", query: "education support", category: "education" },
                { text: "Are services free of charge?", query: "services free charge", category: "general" }
            ],
            ar: [
                { text: "كيف أسجل للحصول على المساعدة النقدية؟", query: "تسجيل مساعدة نقدية", category: "cash_transfer" },
                { text: "أين يمكنني الحصول على الخدمات الصحية؟", query: "موقع الخدمات الصحية", category: "health_nutrition" },
                { text: "ما هي خدمات حماية الأطفال؟", query: "خدمات حماية الأطفال", category: "child_protection" },
                { text: "كيف أبلغ عن طفل غير مرافق؟", query: "إبلاغ طفل غير مرافق", category: "child_protection" },
                { text: "ما الدعم التعليمي المتاح؟", query: "دعم تعليمي", category: "education" },
                { text: "هل الخدمات مجانية؟", query: "خدمات مجانية", category: "general" }
            ]
        };

        function generateSessionId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // Update language button states
            document.getElementById('langEn').classList.toggle('active', lang === 'en');
            document.getElementById('langAr').classList.toggle('active', lang === 'ar');
            
            // Update text content
            const t = translations[lang];
            document.getElementById('chatbotTitle').textContent = t.chatbotTitle;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('welcomeTitle').textContent = t.welcomeTitle;
            document.getElementById('welcomeText').textContent = t.welcomeText;
            document.getElementById('quickActionsTitle').textContent = t.quickActionsTitle;
            document.getElementById('typingText').textContent = t.typingText;
            document.getElementById('userInput').placeholder = t.inputPlaceholder;
            document.getElementById('sendText').textContent = t.sendText;
            document.getElementById('shareText').textContent = t.shareText;
            document.getElementById('disclaimer').textContent = t.disclaimer;
            
            // Update quick actions
            updateQuickActions();
            
            // Add welcome message for new language
            addMessage('assistant', t.welcomeText);
        }

        function updateQuickActions() {
            const container = document.getElementById('quickActionsGrid');
            const questions = quickQuestionsData[currentLanguage];
            
            container.innerHTML = '';
            questions.forEach((question, index) => {
                const button = document.createElement('button');
                button.className = 'bg-white border border-gray-200 rounded-lg p-3 text-left hover:bg-blue-50 hover:border-blue-300 transition-colors';
                button.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-question-circle text-blue-600"></i>
                        <span class="text-sm text-gray-700">${question.text}</span>
                    </div>
                `;
                button.onclick = () => sendQuickQuestion(question.query);
                container.appendChild(button);
            });
        }

        function addMessage(sender, message) {
            const messagesContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender === 'user' ? 'text-right' : 'text-left'}`;
            
            const messageContent = sender === 'user' ? `
                <div class="inline-block max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl">
                    <div class="bg-blue-600 text-white rounded-lg px-4 py-2">
                        ${message}
                    </div>
                </div>
            ` : `
                <div class="inline-block max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl">
                    <div class="bg-white border border-gray-200 rounded-lg px-4 py-2 shadow-sm">
                        ${message}
                    </div>
                </div>
            `;
            
            messageDiv.innerHTML = messageContent;
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator(show) {
            const indicator = document.getElementById('typingIndicator');
            indicator.classList.toggle('hidden', !show);
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage('user', message);
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator(true);
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        language: currentLanguage,
                        sessionId: sessionId
                    })
                });
                
                const data = await response.json();
                showTypingIndicator(false);
                
                if (data.success) {
                    addMessage('assistant', data.response);
                } else {
                    addMessage('assistant', 'Sorry, I encountered an error. Please try again.');
                }
            } catch (error) {
                showTypingIndicator(false);
                addMessage('assistant', 'Sorry, I cannot connect right now. Please try again later.');
                console.error('Chat error:', error);
            }
        }

        async function sendQuickQuestion(query) {
            // Add user message
            addMessage('user', query);
            
            // Show typing indicator
            showTypingIndicator(true);
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: query,
                        language: currentLanguage,
                        sessionId: sessionId
                    })
                });
                
                const data = await response.json();
                showTypingIndicator(false);
                
                if (data.success) {
                    addMessage('assistant', data.response);
                } else {
                    addMessage('assistant', 'Sorry, I encountered an error. Please try again.');
                }
            } catch (error) {
                showTypingIndicator(false);
                addMessage('assistant', 'Sorry, I cannot connect right now. Please try again later.');
                console.error('Chat error:', error);
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function shareOnWhatsApp() {
            const url = window.location.href;
            const text = currentLanguage === 'ar' 
                ? `مرحباً! أريد مشاركة معك مساعد اليونيسف فلسطين للخدمات المعلوماتية. ${url}`
                : `Hello! I want to share with you the UNICEF Palestine Assistant for information services. ${url}`;
            
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Initialize the chat interface
        document.addEventListener('DOMContentLoaded', function() {
            updateQuickActions();
            
            // Add initial welcome message
            const t = translations[currentLanguage];
            setTimeout(() => {
                addMessage('assistant', t.welcomeText);
            }, 500);
        });

        // Handle Arabic text direction
        function updateTextDirection() {
            const isRtl = currentLanguage === 'ar';
            document.body.dir = isRtl ? 'rtl' : 'ltr';
            document.body.style.textAlign = isRtl ? 'right' : 'left';
        }

        // Update text direction when language changes
        const originalSwitchLanguage = switchLanguage;
        switchLanguage = function(lang) {
            originalSwitchLanguage(lang);
            updateTextDirection();
        };

        // Initialize text direction
        updateTextDirection();
    </script>
</body>
</html>